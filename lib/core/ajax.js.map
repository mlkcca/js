{"version":3,"sources":["core/ajax.js"],"names":["http","require","https","querystring","request","method","secure","host","port","path","qs","payload","headers","callback","http_client","stringify","options","hostname","get","process_response","on","e","req","setTimeout","Error","abort","err","write","end","res","content","str","JSON","parse","requestBrowser","_port","url","xhr","createCORSRequest","withCredentials","onload","decoded","parsed","responseText","onerror","statusText","header_key","setRequestHeader","send","process","title","module","exports","console","log","XMLHttpRequest","open","XDomainRequest"],"mappings":"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","file":"ajax.js","sourcesContent":["var http = require(\"http\"),\n    https = require('https'),\n    querystring = require(\"querystring\");\n/*\nmethod\nutl\nparams\ncallback\nsecure\n*/\nfunction request(method, secure, host, port, path, qs, payload, headers, callback) {\n\tvar http_client = secure ? https : http;\n\t//headers['Content-Type'] = 'application/x-www-form-urlencoded';\n\n\tif(qs) {\n\t\tpath += \"?\" + querystring.stringify(qs);\n\t}\n\n\tvar options = {\n\t\thostname: host,\n\t\tport: port || (secure ? 443 : 80),\n\t\tpath: path,\n\t\tmethod: method,\n\t\theaders : headers\n\t};\n\n\tif(method == 'GET') {\n\t\thttp_client.get(options, process_response)\n\t\t.on('error', function (e) {\n\t\t\tcallback(e);\n\t\t});\n\t}else{\n\t\tvar req = http_client.request(options, process_response);\n\t\treq.setTimeout(5000);\n\t\treq.on('timeout', function() {\n\t\t\tif(callback) callback(new Error(\"timed out\"), null);\n\t\t\treq.abort();\n\t\t});\n\t\treq.on('error', function(err) {\n\t\t\tif(callback) callback(err, null);\n\t\t});\n\t\treq.write(payload);\n\t\treq.end();\n\t}\n\n\tfunction process_response(res) {\n\t\tif(callback) {\n\t\t\tvar content = \"\";\n\t\t\tres.on('data', function(str) {\n\t\t\t\tcontent += str;\n\t\t\t});\n\t\t\tres.on('end', function() {\n\t\t\t\tcallback(null, JSON.parse(content));\n\t\t\t});\n\t\t}\n\t}\n}\n\nfunction requestBrowser(method, secure, host, _port, path, qs, payload, headers, callback) {\n\tlet port = _port || (secure?443:80);\n\tvar url = (secure?'https://':'http://') + host + ':' + port + path;\n\tif(qs) {\n\t\turl += \"?\" + querystring.stringify(qs);\n\t}\n\tvar xhr = createCORSRequest(method , url);\n\txhr.withCredentials = true;\n\txhr.onload = function() {\n\t\tlet decoded = \"\";\n\t\ttry{\n\t\t\tvar parsed = JSON.parse(xhr.responseText);\n    \t\tcallback(null, parsed);\n\t\t}catch(e){\n    \t\tcallback(null, JSON.parse(xhr.responseText));\n\t\t}\n\t}\n\txhr.onerror = function() {\n\t\tcallback(xhr.statusText || 'unknown error');\n\t}\n\t//xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\tfor(var header_key in headers) {\n\t\txhr.setRequestHeader(header_key, headers[header_key]);\n\t}\n\n\txhr.send(payload);\n}\n\nif ('browser' !== process.title) {\n\tmodule.exports = {\n\t\trequest : request\n\t}\n}else{\n\tmodule.exports = {\n\t\trequest : requestBrowser\n\t}\n}\n\n\n\nfunction createCORSRequest(method, url) {\n\tconsole.log(url);\n    var xhr = new XMLHttpRequest();\n    if (\"withCredentials\" in xhr) {\n        xhr.open(method, url, true);\n    } else if (typeof XDomainRequest != \"undefined\") {\n        xhr = new XDomainRequest();\n        xhr.open(method, url);\n    } else {\n        xhr = null;\n    }\n    return xhr;\n}"]}